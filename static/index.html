<!DOCTYPE html>
<!--
 Copyright (c) 2025 BillChen

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
-->

<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Jarvis</title>
  <!-- DNS È¢ÑËß£ÊûêÂíåÈ¢ÑËøûÊé• CDN -->
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdnjs.cloudflare.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="stylesheet" href="/static/styles.css?v=123">
  <link rel="stylesheet" href="/static/chat.css?v=2">
  <!-- xterm.js -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.css">
</head>
<body>
  <!-- ÁôªÂΩïËßÜÂõæ -->
  <div id="login-view" class="view active">
    <div class="login-container">
      <div class="login-card">
        <h1 class="login-title">Jarvis</h1>
        <p class="login-subtitle" data-i18n="login.subtitle">Ready to assist.</p>
        <form id="login-form" class="login-form">
          <input
            type="password"
            id="login-token"
            class="login-input"
            data-i18n-placeholder="login.placeholder"
            placeholder="¬∑¬∑¬∑¬∑¬∑¬∑"
            autocomplete="current-password"
            required
          >
          <div id="login-error" class="login-error"></div>
          <button type="submit" id="login-btn" class="btn btn-primary btn-block" data-i18n="login.button">
            Enter
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- ‰ºöËØùÂàóË°®ËßÜÂõæ -->
  <div id="sessions-view" class="view">
    <header class="header">
      <div class="header-title" onclick="window.app && window.app.toggleDebugPanel()">
        <div class="system-info">
          <span class="system-user-host"><span id="system-username">--</span>@<span id="system-hostname" class="hostname">--</span></span>
          <span id="system-ip" class="system-ip">--</span>
        </div>
      </div>
      <div class="header-actions">
        <button id="usage-toggle-btn" class="btn-usage" data-i18n-title="sessions.usage">‚â°</button>
        <button id="create-session" class="btn-add">+</button>
        <button id="settings-btn" class="btn-settings" data-i18n-title="sessions.settings">‚öôÔ∏é</button>
        <button id="sessions-help-btn" class="btn-help" data-i18n-title="sessions.help">?</button>
      </div>
    </header>

    <!-- Â∏ÆÂä©Èù¢Êùø -->
    <div id="sessions-help-panel" class="help-panel sessions-help-panel">
      <div class="help-content">
        <div class="help-header">
          <span data-i18n="sessions.help.title">Help</span>
          <button id="sessions-help-close">‚úï</button>
        </div>
        <div class="help-list">
          <div class="help-item"><span class="help-key">‚â°</span><span data-i18n="sessions.help.usage">View usage stats</span></div>
          <div class="help-item"><span class="help-key">‚Üì</span><span data-i18n="sessions.help.pull">Light pull refresh / Heavy pull reload</span></div>
          <div class="help-item"><span class="help-key">‚úé ‚úï</span><span data-i18n="sessions.help.cardButtons">Rename / Delete session</span></div>
          <div class="help-item"><span class="help-key">‚ñ§</span><span data-i18n="sessions.help.history">View terminal history</span></div>
        </div>
        <div class="help-section-title" data-i18n="sessions.help.contextTitle">Context Icons</div>
        <div class="help-list help-list-icons">
          <div class="help-item"><span class="help-key help-key-purple">‚õÅ</span><span data-i18n="sessions.help.ctxUsed">Used / Max (%)</span></div>
          <div class="help-item"><span class="help-key help-key-gray">‚õ∂</span><span data-i18n="sessions.help.ctxFree">Free space</span></div>
          <div class="help-item"><span class="help-key help-key-gray">‚õù</span><span data-i18n="sessions.help.ctxCompact">Until compact</span></div>
          <div class="help-item"><span class="help-key help-key-green">‚ö°</span><span data-i18n="sessions.help.ctxTotal">Total consumed</span></div>
        </div>
        <div class="help-tips">
          <div class="help-tip">üí° <span data-i18n="sessions.help.tip">Click top-left for debug logs</span></div>
        </div>
      </div>
    </div>

    <!-- Áî®ÈáèÁªüËÆ°ÊäΩÂ±â -->
    <div id="usage-drawer" class="usage-drawer">
      <div class="usage-drawer-content">
        <!-- Áî®Êà∑‰ø°ÊÅØ -->
        <div class="drawer-section user-profile">
          <div class="profile-header">
            <span id="profile-name" class="profile-name">--</span>
            <span id="profile-plan" class="profile-plan">--</span>
          </div>
          <div class="profile-footer">
            <span id="profile-email" class="profile-email">--</span>
            <span class="profile-stats">
              <span id="active-connections" class="stat-num">0</span><span data-i18n="usage.connections">Conn</span> ¬∑ <span id="active-terminals" class="stat-num">0</span><span data-i18n="usage.terminals">Term</span>
            </span>
          </div>
        </div>

        <!-- Áî®ÈáèËøõÂ∫¶Êù° -->
        <div class="drawer-section usage-bars">
          <!-- 5Â∞èÊó∂Âë®Êúü -->
          <div class="usage-bar-item">
            <div class="usage-bar-header">
              <span class="usage-bar-label" data-i18n="usage.fiveHour">5-hour period</span>
              <span id="usage-5h-percent" class="usage-bar-percent">--%</span>
            </div>
            <div class="usage-progress-bar">
              <div id="usage-5h-progress" class="usage-progress" style="width: 0%"></div>
            </div>
            <div id="usage-5h-reset" class="usage-bar-reset">--</div>
          </div>

          <!-- 7Â§©Âë®Êúü -->
          <div class="usage-bar-item">
            <div class="usage-bar-header">
              <span class="usage-bar-label" data-i18n="usage.sevenDay">7-day period</span>
              <span id="usage-7d-percent" class="usage-bar-percent">--%</span>
            </div>
            <div class="usage-progress-bar">
              <div id="usage-7d-progress" class="usage-progress" style="width: 0%"></div>
            </div>
            <div id="usage-7d-reset" class="usage-bar-reset">--</div>
          </div>

          <!-- Sonnet ‰∏ìÁî® -->
          <div class="usage-bar-item" id="usage-sonnet-section">
            <div class="usage-bar-header">
              <span class="usage-bar-label">Sonnet</span>
              <span id="usage-sonnet-percent" class="usage-bar-percent">--%</span>
            </div>
            <div class="usage-progress-bar">
              <div id="usage-sonnet-progress" class="usage-progress" style="width: 0%"></div>
            </div>
            <div id="usage-sonnet-reset" class="usage-bar-reset">--</div>
          </div>
        </div>

      </div>
    </div>

    <main class="main" id="sessions-main">
      <!-- Â∑¶Âè≥ÊªëÂä®ÂÆπÂô® -->
      <div class="swipe-container" id="swipe-container">
        <!-- Á¨¨‰∏ÄÂ±è: È°πÁõÆÂàóË°® -->
        <div class="swipe-page" id="page-projects">
          <!-- ‰∏ãÊãâÂà∑Êñ∞ÊåáÁ§∫Âô® -->
          <div id="pull-refresh" class="pull-refresh">
            <div class="pull-refresh-spinner"></div>
            <span class="pull-refresh-text" data-i18n="sessions.pullToRefresh">Pull to refresh</span>
          </div>
          <div id="sessions-list" class="sessions-list">
            <div class="loading" data-i18n="sessions.loading">Loading...</div>
          </div>
        </div>
        <!-- Á¨¨‰∫åÂ±è: ÊâÄÊúâ‰ºöËØùÁΩëÊ†º -->
        <div class="swipe-page" id="page-all-sessions">
          <!-- ‰∏ãÊãâÂà∑Êñ∞ÊåáÁ§∫Âô® -->
          <div id="pull-refresh-sessions" class="pull-refresh">
            <div class="pull-refresh-spinner"></div>
            <span class="pull-refresh-text" data-i18n="sessions.pullToRefresh">Pull to refresh</span>
          </div>
          <div id="all-sessions-grid" class="all-sessions-grid">
            <div class="loading" data-i18n="sessions.loading">Loading...</div>
          </div>
        </div>
        <!-- Á¨¨‰∏âÂ±è: Êñá‰ª∂ÊµèËßàÂô® -->
        <div class="swipe-page" id="page-files">
          <!-- ‰∏ãÊãâÂà∑Êñ∞ÊåáÁ§∫Âô® -->
          <div id="pull-refresh-files" class="pull-refresh">
            <div class="pull-refresh-spinner"></div>
            <span class="pull-refresh-text" data-i18n="sessions.pullToRefresh">Pull to refresh</span>
          </div>
          <!-- Êñá‰ª∂ÊµèËßàÂô®ÂÜÖÂÆπ -->
          <div id="files-browser" class="files-browser">
            <!-- Ë∑ØÂæÑÂØºËà™Ê†è -->
            <div class="files-path-bar">
              <button id="files-back-btn" class="btn-files-nav" disabled>‚Üê</button>
              <div id="files-current-path" class="files-current-path">~</div>
              <button id="files-hidden-btn" class="btn-files-nav" title="Show Hidden Files">‚¶ø</button>
              <button id="files-sort-btn" class="btn-files-nav" title="Sort">A‚Üì</button>
              <button id="files-menu-btn" class="btn-files-nav">‚ãÆ</button>
            </div>
            <!-- Âø´Êç∑ËÆøÈóÆ -->
            <div id="files-favorites" class="files-favorites"></div>
            <!-- Êñá‰ª∂ÂàóË°® -->
            <div id="files-list" class="files-list">
              <div class="loading" data-i18n="sessions.loading">Loading...</div>
            </div>
          </div>
        </div>
        <!-- Á¨¨ÂõõÂ±è: ËøúÁ®ãÊú∫Âô® -->
        <div class="swipe-page" id="page-remote">
          <!-- ‰∏ãÊãâÂà∑Êñ∞ÊåáÁ§∫Âô® -->
          <div id="pull-refresh-remote" class="pull-refresh">
            <div class="pull-refresh-spinner"></div>
            <span class="pull-refresh-text" data-i18n="sessions.pullToRefresh">Pull to refresh</span>
          </div>
          <!-- ËøúÁ®ãÊú∫Âô®ÂàóË°® -->
          <div class="remote-machines-container" id="remote-machines-content">
            <div id="remote-machines-list" class="remote-machines-list">
              <div class="loading" data-i18n="sessions.loading">Loading...</div>
            </div>
            <!-- Ê∑ªÂä†ÊåâÈíÆÊîæÂú®ÂàóË°®Â∫ïÈÉ® -->
            <button id="add-remote-machine-btn" class="remote-machine-add-btn" title="Add Remote Machine">
              <span class="add-icon">+</span>
              <span class="add-text" data-i18n="remote.addMachine">Add Machine</span>
            </button>
          </div>
        </div>
        <!-- Á¨¨‰∫îÂ±è: Á≥ªÁªüÁõëÊéß -->
        <div class="swipe-page" id="page-monitor">
          <!-- ‰∏ãÊãâÂà∑Êñ∞ÊåáÁ§∫Âô® -->
          <div id="pull-refresh-monitor" class="pull-refresh">
            <div class="pull-refresh-spinner"></div>
            <span class="pull-refresh-text" data-i18n="sessions.pullToRefresh">Pull to refresh</span>
          </div>
          <div class="monitor-container" id="monitor-content">
            <!-- 1. CPU & ÂÜÖÂ≠ò -->
            <div class="monitor-stats-row">
              <div class="monitor-stat-card">
                <div class="stat-label">CPU</div>
                <div class="stat-ring" id="cpu-ring">
                  <svg viewBox="0 0 36 36">
                    <path class="ring-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                    <path class="ring-progress" id="cpu-progress" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                  </svg>
                  <span class="stat-value" id="cpu-value">--%</span>
                </div>
                <div class="stat-detail" id="cpu-detail">-- cores</div>
              </div>
              <div class="monitor-stat-card">
                <div class="stat-label" data-i18n="monitor.memory">Memory</div>
                <div class="stat-ring" id="mem-ring">
                  <svg viewBox="0 0 36 36">
                    <path class="ring-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                    <path class="ring-progress" id="mem-progress" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                  </svg>
                  <span class="stat-value" id="mem-value">--%</span>
                </div>
                <div class="stat-detail" id="mem-detail">-- / --</div>
              </div>
            </div>
            <!-- 2. Top ËøõÁ®ã -->
            <div class="monitor-section">
              <div class="section-title-row">
                <span class="section-title" data-i18n="monitor.topProcesses">Top Processes</span>
                <div class="process-controls">
                  <select id="process-sort" class="process-select">
                    <option value="cpu">CPU</option>
                    <option value="memory" data-i18n="monitor.memory">Memory</option>
                  </select>
                  <select id="process-count" class="process-select">
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="15">15</option>
                  </select>
                </div>
              </div>
              <div id="process-list" class="process-list">
                <div class="loading-small">...</div>
              </div>
            </div>
            <!-- 3. JarvisÔºàÂ±ïÂºÄÊòæÁ§∫ÂÖ®ÈÉ®ËøõÁ®ãÔºâ -->
            <div class="monitor-section">
              <div class="section-title">Jarvis</div>
              <div id="jarvis-info" class="jarvis-info">
                <div class="loading-small">...</div>
              </div>
            </div>
            <!-- 4. Á£ÅÁõòÔºàÊúÄÂêéÔºâ -->
            <div class="monitor-section">
              <div class="section-title" data-i18n="monitor.disk">Disk</div>
              <div id="disk-list" class="disk-list">
                <div class="loading-small">...</div>
              </div>
            </div>
          </div>
        </div>
        <!-- Á¨¨ÂÖ≠Â±è: ÂÆöÊó∂‰ªªÂä° -->
        <div class="swipe-page" id="page-scheduled-tasks">
          <!-- ‰∏ãÊãâÂà∑Êñ∞ÊåáÁ§∫Âô® -->
          <div id="pull-refresh-tasks" class="pull-refresh">
            <div class="pull-refresh-spinner"></div>
            <span class="pull-refresh-text" data-i18n="sessions.pullToRefresh">Pull to refresh</span>
          </div>
          <div class="scheduled-tasks-container" id="scheduled-tasks-content">
            <div id="scheduled-tasks-list" class="scheduled-tasks-list">
              <div class="loading" data-i18n="sessions.loading">Loading...</div>
            </div>
          </div>
        </div>
      </div>
      <!-- È°µÈù¢ÊåáÁ§∫Âô® -->
      <div class="page-indicator" id="page-indicator">
        <span class="page-dot active" data-page="0"></span>
        <span class="page-dot" data-page="1"></span>
        <span class="page-dot" data-page="2"></span>
        <span class="page-dot" data-page="3"></span>
        <span class="page-dot" data-page="4"></span>
        <span class="page-dot" data-page="5"></span>
      </div>
    </main>

    <!-- Êñá‰ª∂‰∏ãËΩΩÁ°ÆËÆ§Ê°Ü -->
    <div id="file-confirm-modal" class="file-confirm-modal">
      <div class="file-confirm-content">
        <div class="file-confirm-icon" id="file-confirm-icon">‚ñ¢</div>
        <div class="file-confirm-name" id="file-confirm-name">filename.txt</div>
        <div class="file-confirm-meta">
          <span id="file-confirm-size">12.5 KB</span>
          <span class="file-confirm-sep">¬∑</span>
          <span id="file-confirm-date">Dec 15, 2024</span>
        </div>
        <div class="file-confirm-buttons">
          <button id="file-confirm-cancel" class="btn btn-secondary" data-i18n="common.cancel">Cancel</button>
          <button id="file-confirm-download" class="btn btn-primary">‚Üì <span data-i18n="files.download">Download</span></button>
        </div>
      </div>
    </div>

    <!-- Êñá‰ª∂È¢ÑËßàÊ®°ÊÄÅÊ°Ü -->
    <div id="file-preview-modal" class="file-preview-modal">
      <div class="file-preview-header">
        <span class="file-preview-name" id="preview-file-name">filename.txt</span>
        <div class="file-preview-actions">
          <button id="preview-font-decrease" class="btn-preview-action btn-font-ctrl" title="Decrease font size">A-</button>
          <button id="preview-font-increase" class="btn-preview-action btn-font-ctrl" title="Increase font size">A+</button>
          <button id="preview-download-btn" class="btn-preview-action" title="Download">‚Üì</button>
          <button id="preview-close-btn" class="btn-preview-action" title="Close">‚úï</button>
        </div>
      </div>
      <div class="file-preview-body" id="file-preview-body">
        <!-- ÂÜÖÂÆπÁî± JS Âä®ÊÄÅÂàõÂª∫ -->
        <!-- Âä†ËΩΩ‰∏≠ -->
        <div id="preview-loading" class="preview-loading">Loading...</div>
        <!-- ÈîôËØØ -->
        <div id="preview-error" class="preview-error" style="display:none"></div>
      </div>
    </div>
  </div>

  <!-- ÂàõÂª∫‰ºöËØùÊ®°ÊÄÅÊ°Ü -->
  <div id="create-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title">New Session</h2>
        <button id="modal-close" class="btn-close">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Ê≠•È™§1: ÈÄâÊã©Â∑•‰ΩúÁõÆÂΩï -->
        <div id="step-workdir" class="step active">
          <div class="step-title">Select Working Directory</div>
          <!-- ÂéÜÂè≤ÁõÆÂΩï -->
          <div id="history-dirs" class="history-dirs">
            <div class="section-label">Recent Directories</div>
            <div id="workdir-list" class="workdir-list">
              <div class="loading">Loading...</div>
            </div>
          </div>
          <!-- ÁõÆÂΩïÊµèËßàÂô® -->
          <div class="dir-browser">
            <div class="section-label">Browse</div>
            <div class="current-path">
              <button id="go-parent" class="btn btn-icon">‚Üë</button>
              <span id="current-path-text">~</span>
              <button id="select-current" class="btn btn-primary">Select</button>
            </div>
            <div id="dir-list" class="dir-list">
              <div class="loading">Loading...</div>
            </div>
          </div>
        </div>
        <!-- Ê≠•È™§2: ÈÄâÊã© Claude ‰ºöËØù -->
        <div id="step-session" class="step">
          <div class="step-title">Select Claude Session</div>
          <div class="selected-workdir">
            <span id="selected-workdir-text"></span>
            <button id="change-workdir" class="btn btn-text">Change</button>
          </div>
          <div id="claude-sessions" class="claude-sessions">
            <div class="loading">Loading...</div>
          </div>
          <button id="create-new-session" class="btn btn-primary btn-block">New Session</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ËøúÁ®ãÊú∫Âô®Ê®°ÊÄÅÊ°Ü -->
  <div id="remote-machine-modal" class="modal">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2 id="remote-machine-modal-title" data-i18n="remote.addMachine">Add Remote Machine</h2>
        <button id="remote-machine-modal-close" class="btn-close">&times;</button>
      </div>
      <div class="modal-body">
        <form id="remote-machine-form" class="settings-form">
          <div class="form-group">
            <label data-i18n="remote.name">Name</label>
            <input type="text" id="machine-name" class="form-input" data-i18n-placeholder="remote.namePlaceholder" placeholder="My Server" required>
          </div>
          <div class="form-group">
            <label data-i18n="remote.host">Host</label>
            <input type="text" id="machine-host" class="form-input" data-i18n-placeholder="remote.hostPlaceholder" placeholder="192.168.1.100 or example.com" required>
          </div>
          <div class="form-group">
            <label data-i18n="remote.port">Port</label>
            <input type="number" id="machine-port" class="form-input" value="22" min="1" max="65535">
          </div>
          <div class="form-group">
            <label data-i18n="remote.username">Username</label>
            <input type="text" id="machine-username" class="form-input" required>
          </div>
          <div class="form-group">
            <label data-i18n="remote.password">Password</label>
            <input type="password" id="machine-password" class="form-input">
          </div>
          <div id="test-connection-result" class="test-result"></div>
          <div class="form-buttons">
            <button type="button" id="test-connection-btn" class="btn btn-secondary" data-i18n="remote.testConnection">Test Connection</button>
            <button type="button" id="save-remote-machine-btn" class="btn btn-primary" data-i18n="remote.save">Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ËÆæÁΩÆÊ®°ÊÄÅÊ°Ü -->
  <div id="settings-modal" class="modal">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <div class="modal-header-left">
          <button id="settings-back-btn" class="btn-back-small hidden">‚Üê</button>
        </div>
        <h2 id="settings-modal-title" data-i18n="sessions.settings">Settings</h2>
        <div class="modal-header-right">
          <button id="settings-modal-close" class="btn-close">&times;</button>
        </div>
      </div>
      <div class="modal-body">
        <!-- ‰∏ªËèúÂçï -->
        <div id="settings-menu" class="settings-menu">
          <div class="settings-menu-item" id="menu-language">
            <span data-i18n="settings.language">Language</span>
            <div class="settings-menu-right">
              <span class="settings-menu-value" id="current-lang-display">English</span>
              <span class="settings-menu-arrow">‚Ä∫</span>
            </div>
          </div>
          <div class="settings-menu-item" id="menu-theme">
            <span data-i18n="settings.theme">Theme</span>
            <span class="settings-menu-arrow">‚Ä∫</span>
          </div>
          <div class="settings-menu-item" id="menu-password">
            <span data-i18n="settings.title">Change Password</span>
            <span class="settings-menu-arrow">‚Ä∫</span>
          </div>
          <div class="settings-menu-item settings-menu-danger" id="menu-logout">
            <span data-i18n="settings.logout">Logout</span>
          </div>
        </div>
        <!-- ÈöêËóèÁöÑÊñá‰ª∂ËæìÂÖ• -->
        <input type="file" id="file-input" style="display:none">

        <!-- ËØ≠Ë®ÄËÆæÁΩÆÈ°µ (Âä®ÊÄÅÁîüÊàê) -->
        <div id="settings-language" class="settings-page"></div>

        <!-- ‰∏ªÈ¢òËÆæÁΩÆÈ°µ -->
        <div id="settings-theme" class="settings-page">
          <div class="settings-section">
            <div class="settings-section-title" data-i18n="theme.colorMode">Color Mode</div>
            <div class="theme-options theme-modes">
              <label class="theme-option">
                <input type="radio" name="theme-mode" value="dark" checked>
                <span class="theme-option-box">
                  <span class="theme-option-icon">üåô</span>
                  <span class="theme-option-label" data-i18n="theme.dark">Dark</span>
                </span>
              </label>
              <label class="theme-option">
                <input type="radio" name="theme-mode" value="light">
                <span class="theme-option-box">
                  <span class="theme-option-icon">‚òÄÔ∏è</span>
                  <span class="theme-option-label" data-i18n="theme.light">Light</span>
                </span>
              </label>
              <label class="theme-option">
                <input type="radio" name="theme-mode" value="system">
                <span class="theme-option-box">
                  <span class="theme-option-icon">üíª</span>
                  <span class="theme-option-label" data-i18n="theme.system">System</span>
                </span>
              </label>
            </div>
          </div>

          <div class="settings-section">
            <div class="settings-section-title" data-i18n="theme.primaryColor">Primary Color</div>
            <div class="theme-options theme-colors">
              <label class="theme-color-option">
                <input type="radio" name="theme-color" value="blue" checked>
                <span class="theme-color-box" style="--option-color: #4a9eff;"></span>
              </label>
              <label class="theme-color-option">
                <input type="radio" name="theme-color" value="green">
                <span class="theme-color-box" style="--option-color: #10b981;"></span>
              </label>
              <label class="theme-color-option">
                <input type="radio" name="theme-color" value="purple">
                <span class="theme-color-box" style="--option-color: #8b5cf6;"></span>
              </label>
              <label class="theme-color-option">
                <input type="radio" name="theme-color" value="orange">
                <span class="theme-color-box" style="--option-color: #f59e0b;"></span>
              </label>
              <label class="theme-color-option">
                <input type="radio" name="theme-color" value="pink">
                <span class="theme-color-box" style="--option-color: #ec4899;"></span>
              </label>
            </div>
          </div>

          <div class="settings-section">
            <div class="settings-section-title" data-i18n="theme.fontSize">Font Size</div>
            <div class="theme-options theme-sizes">
              <label class="theme-option">
                <input type="radio" name="theme-size" value="small">
                <span class="theme-option-box">
                  <span class="theme-option-icon" style="font-size: 14px;">A</span>
                  <span class="theme-option-label" data-i18n="theme.small">Small</span>
                </span>
              </label>
              <label class="theme-option">
                <input type="radio" name="theme-size" value="medium" checked>
                <span class="theme-option-box">
                  <span class="theme-option-icon" style="font-size: 16px;">A</span>
                  <span class="theme-option-label" data-i18n="theme.medium">Medium</span>
                </span>
              </label>
              <label class="theme-option">
                <input type="radio" name="theme-size" value="large">
                <span class="theme-option-box">
                  <span class="theme-option-icon" style="font-size: 18px;">A</span>
                  <span class="theme-option-label" data-i18n="theme.large">Large</span>
                </span>
              </label>
            </div>
          </div>
        </div>

        <!-- ‰øÆÊîπÂØÜÁ†ÅÈ°µ -->
        <div id="settings-password" class="settings-page">
          <form id="change-password-form" class="settings-form">
            <div class="form-group">
              <label data-i18n="settings.oldPassword">Old password</label>
              <input type="password" id="old-password" class="form-input" required>
            </div>
            <div class="form-group">
              <label data-i18n="settings.newPassword">New password</label>
              <input type="password" id="new-password" class="form-input" data-i18n-placeholder="settings.newPasswordHint" placeholder="At least 6 characters" required>
            </div>
            <div class="form-group">
              <label data-i18n="settings.confirmPassword">Confirm password</label>
              <input type="password" id="confirm-password" class="form-input" required>
            </div>
            <div id="password-error" class="form-error"></div>
            <button type="submit" id="change-password-btn" class="btn btn-primary btn-block" data-i18n="settings.confirm">
              Confirm
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat ËßÜÂõæ -->
  <div id="chat-view" class="view"></div>

  <!-- ÁªàÁ´ØËßÜÂõæ -->
  <div id="terminal-view" class="view">
    <!-- Â∑•ÂÖ∑Ê†è -->
    <header class="toolbar">
      <button id="back-btn" class="btn-toolbar" data-i18n-title="terminal.close" title="Close">‚Üê</button>
      <button id="minimize-btn" class="btn-toolbar" data-i18n-title="terminal.minimize" title="Minimize">‚åÑ</button>
      <div class="toolbar-center" onclick="window.app && window.app.toggleDebugPanel()">
        <div class="toolbar-title-row">
          <span id="connection-dot" class="connection-dot"></span>
          <span id="terminal-title" class="terminal-title">Terminal</span>
          <span id="connection-status" class="connection-status"></span>
        </div>
        <span id="git-branch" class="git-branch-text"></span>
      </div>
      <div class="toolbar-right">
        <button id="chat-mode-btn" class="btn-toolbar btn-chat-mode" data-i18n-title="terminal.chatMode" title="Chat Mode">‚¨°</button>
        <button id="terminal-history-btn" class="btn-toolbar" data-i18n-title="terminal.historyBtn" title="History">‚ñ§</button>
        <button id="help-btn" class="btn-help" onclick="window.app && window.app.toggleHelpPanel(event)">?</button>
      </div>
    </header>

    <!-- ÊÇ¨ÊµÆÂ≠ó‰ΩìÊéßÂà∂ + ‰∏ªÈ¢ò + Context ÊåâÈíÆ -->
    <div class="font-controls-float">
      <button id="font-decrease" class="btn-font">A-</button>
      <button id="font-increase" class="btn-font">A+</button>
      <button id="theme-toggle" class="btn-font btn-theme" title="Theme">‚óê</button>
      <button id="context-toggle" class="btn-font btn-context" title="Context Info">‚õÅ</button>
      <button id="workdir-btn" class="btn-font btn-workdir" title="Open Working Directory">üìÇ</button>
      <button id="rename-session-btn" class="btn-font btn-rename" data-i18n-title="common.rename" title="Rename Session">‚úé</button>
    </div>

    <!-- Context ‰ø°ÊÅØÊÇ¨ÊµÆÊù°ÔºàÈªòËÆ§Êî∂Ëµ∑Ôºâ -->
    <div id="context-bar" class="context-bar collapsed" onclick="window.app && window.app.refreshContextInfo()">
      <!-- ÂÜÖÂÆπÁî± JS Âä®ÊÄÅÁîüÊàê -->
    </div>

    <!-- Â∏ÆÂä©Èù¢Êùø -->
    <div id="help-panel" class="help-panel">
      <div class="help-content">
        <div class="help-header">
          <span data-i18n="terminal.help.title">Keyboard shortcuts</span>
          <button onclick="window.app && window.app.toggleHelpPanel(event)">‚úï</button>
        </div>
        <div class="help-section-title" data-i18n="terminal.help.keysTitle">Shortcuts</div>
        <div class="help-color-legend">
          <span class="legend-item legend-nav" data-i18n="terminal.help.nav">Nav</span>
          <span class="legend-item legend-danger" data-i18n="terminal.help.danger">Stop</span>
          <span class="legend-item legend-action" data-i18n="terminal.help.action">Action</span>
        </div>
        <div class="help-list">
          <div class="help-item"><span class="help-key help-key-nav">‚Üë‚Üì</span><span data-i18n="terminal.help.history">History</span></div>
          <div class="help-item"><span class="help-key help-key-nav">‚§í‚§ì</span><span data-i18n="terminal.help.scroll">Scroll (hold for continuous)</span></div>
          <div class="help-item"><span class="help-key help-key-danger">ESC</span><span data-i18n="terminal.help.stop">Stop</span></div>
          <div class="help-item"><span class="help-key help-key-action">TAB</span><span data-i18n="terminal.help.complete">Auto complete</span></div>
          <div class="help-item"><span class="help-key help-key-action">‚Üµ</span><span data-i18n="terminal.help.send">Send</span></div>
        </div>
        <div class="help-section-title" data-i18n="terminal.help.floatTitle">Float buttons</div>
        <div class="help-list">
          <div class="help-item"><span class="help-key">A+A-</span><span data-i18n="terminal.help.fontSize">Font size</span></div>
          <div class="help-item"><span class="help-key">‚óê</span><span data-i18n="terminal.help.theme">Switch terminal theme</span></div>
          <div class="help-item"><span class="help-key help-key-purple">‚õÅ</span><span data-i18n="terminal.help.context">Context (tap to refresh & scroll)</span></div>
          <div class="help-item"><span class="help-key">‚äû</span><span data-i18n="terminal.help.workdir">Open working directory</span></div>
          <div class="help-item"><span class="help-key help-key-nav">‚ù∑</span><span data-i18n="terminal.help.switchSession">Switch session / hold to select</span></div>
          <div class="help-item"><span class="help-key">‚ñ§</span><span data-i18n="terminal.help.historyBtn">Terminal history (scroll / pull refresh)</span></div>
        </div>
        <div class="help-tips">
          <div class="help-tip">üí° <span data-i18n="terminal.help.tip">Click ‚ãØ for combo keys and slash commands</span></div>
          <div class="help-tip">üí° <span data-i18n="terminal.help.tipDebug">Click title for debug logs</span></div>
          <div class="help-tip">üí° <span data-i18n="terminal.help.tipFont">Garbled output? Try adjusting font size</span></div>
        </div>
      </div>
    </div>

    <!-- ÁªàÁ´ØËæìÂá∫Âå∫Âüü -->
    <div id="terminal-output" class="terminal-container"></div>

    <!-- Â∫ïÈÉ®ËæìÂÖ•Ê†èÔºàÂ∏∏È©ªÔºâ -->
    <div class="bottom-input-bar">
      <!-- Â±ïÂºÄÁöÑÊõ¥Â§öÊåâÈîÆÈù¢Êùø -->
      <div id="more-keys-panel" class="more-keys-panel">
        <div class="more-keys-section">
          <div class="more-keys-label" data-i18n="terminal.keys.combo">Combo keys</div>
          <div class="more-keys-row">
            <button class="key-btn key-edit" data-key="ctrl-l">^L <span data-i18n="terminal.keys.clear">Clear</span></button>
            <button class="key-btn key-edit" data-key="ctrl-o">^O <span data-i18n="terminal.keys.verbose">Verbose</span></button>
            <button class="key-btn key-nav" data-key="ctrl-b">^B <span data-i18n="terminal.keys.background">Background</span></button>
            <button class="key-btn key-danger" data-key="esc-esc">ESC√ó2 <span data-i18n="terminal.keys.rollback">Rollback</span></button>
            <button class="key-btn key-nav" data-key="shift-tab">‚áßTab <span data-i18n="terminal.keys.mode">Mode</span></button>
          </div>
        </div>
        <div class="more-keys-section">
          <div class="more-keys-label" data-i18n="terminal.keys.slash">Slash commands</div>
          <div class="more-keys-row">
            <button class="key-btn key-action" data-key="cmd-resume">/resume</button>
            <button class="key-btn key-action" data-key="cmd-clear">/clear</button>
            <button class="key-btn key-action" data-key="cmd-help">/help</button>
            <button class="key-btn key-action" data-key="cmd-compact">/compact</button>
          </div>
          <div class="more-keys-row">
            <button class="key-btn key-action" data-key="cmd-memory">/memory</button>
            <button class="key-btn key-action" data-key="cmd-mcp">/mcp</button>
            <button class="key-btn key-action" data-key="cmd-doctor">/doctor</button>
          </div>
        </div>
      </div>
      <!-- ‰∏ªÊåâÈîÆË°å -->
      <div class="special-keys">
        <button class="key-btn key-action" data-key="tab">TAB</button>
        <button class="key-btn key-nav" data-key="up">‚Üë</button>
        <button class="key-btn key-nav" data-key="down">‚Üì</button>
        <button class="key-btn key-danger" data-key="escape">ESC</button>
        <button class="key-btn key-edit" data-key="backspace">‚å´</button>
        <button class="key-btn key-nav" data-key="top">‚§í</button>
        <button class="key-btn key-nav" data-key="bottom">‚§ì</button>
        <button class="key-btn key-action" data-key="enter">‚Üµ</button>
        <button class="key-btn key-more" id="more-keys-btn">‚ãØ</button>
      </div>
      <div class="input-row" id="input-row">
        <!-- input Âä®ÊÄÅÂàõÂª∫ -->
        <button id="send-btn" class="btn btn-primary" data-i18n="terminal.send">Send</button>
      </div>
    </div>
  </div>

  <!-- SSH ÁªàÁ´ØËßÜÂõæ -->
  <div id="ssh-terminal-view" class="view">
    <!-- Â∑•ÂÖ∑Ê†è -->
    <header class="ssh-toolbar">
      <button id="ssh-back-btn" class="btn-toolbar" data-i18n-title="ssh.back" title="Back">&larr;</button>
      <button id="ssh-minimize-btn" class="btn-toolbar" data-i18n-title="ssh.minimize" title="Minimize">&or;</button>
      <div class="ssh-toolbar-center">
        <span id="ssh-connection-dot" class="connection-dot"></span>
        <span id="ssh-terminal-title" class="terminal-title">SSH Terminal</span>
        <span id="ssh-connection-status" class="connection-status"></span>
      </div>
      <div class="ssh-toolbar-right">
        <button id="ssh-pin-btn" class="btn-toolbar" data-i18n-title="ssh.pin" title="Pin to Sessions">&#x2630;</button>
      </div>
    </header>

    <!-- ÊÇ¨ÊµÆÂ≠ó‰ΩìÊéßÂà∂ + ‰∏ªÈ¢òÔºàÂíå Claude terminal ÂØπÈΩêÔºâ -->
    <div class="ssh-font-controls-float">
      <button id="ssh-font-decrease" class="btn-font">A-</button>
      <button id="ssh-font-increase" class="btn-font">A+</button>
      <button id="ssh-theme-toggle" class="btn-font btn-theme" title="Theme">‚óê</button>
    </div>

    <!-- SSH ÁªàÁ´ØËæìÂá∫Âå∫Âüü (ÂÖ®Â±èÔºåÊé•Êî∂ÈîÆÁõòËæìÂÖ•) -->
    <div id="ssh-terminal-output" class="ssh-terminal-container"></div>
  </div>

  <!-- ÂÖ®Â±ÄÈîôËØØÊçïËé∑ -->
  <script>
    window.onerror = function(msg, url, line, col, error) {
      alert('JS Error: ' + msg + ' at ' + url + ':' + line);
      return false;
    };
    window.addEventListener('unhandledrejection', function(event) {
      alert('Promise Error: ' + event.reason);
    });
  </script>
  <!-- ÂºïÂÖ•Â∫îÁî®ËÑöÊú¨ (defer: Âπ∂Ë°åÂä†ËΩΩÔºåÊåâÈ°∫Â∫èÊâßË°å) -->
  <!-- MessagePack ‰∫åËøõÂà∂ÂçèËÆÆ -->
  <!-- SortableJS ÊãñÊãΩÊéíÂ∫è -->
  <!-- Highlight.js ‰ª£Á†ÅÈ´ò‰∫Æ (ÂÖ®ÂäüËÉΩÁâà) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <!-- Marked.js Markdown Ê∏≤Êüì -->
  <script defer src="https://cdnjs.cloudflare.com/ajax/libs/marked/12.0.0/marked.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.2/Sortable.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/@msgpack/msgpack@3.0.0-beta2/dist.es5+umd/msgpack.min.js"></script>
  <script defer src="/static/mux-websocket.js?v=10"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/xterm-addon-webgl@0.16.0/lib/xterm-addon-webgl.js"></script>
  <script defer src="/static/terminal.js?v=12"></script>
  <script defer src="/static/chat.js?v=14"></script>
  <script defer src="/static/session-manager.js?v=16"></script>
  <script defer src="/static/floating-button.js"></script>
  <script defer src="/static/i18n.js?v=34"></script>
  <!-- App Ê®°Âùó -->
  <script defer src="/static/utils.js?v=3"></script>
  <script defer src="/static/debug.js?v=13"></script>
  <script defer src="/static/dialogs.js?v=24"></script>
  <script defer src="/static/settings.js?v=16"></script>
  <script defer src="/static/swipe.js?v=51"></script>
  <script defer src="/static/files.js?v=20"></script>
  <script defer src="/static/projects.js?v=26"></script>
  <script defer src="/static/websocket.js?v=69"></script>
  <script defer src="/static/upload.js?v=5"></script>
  <script defer src="/static/download.js?v=3"></script>
  <script defer src="/static/history.js?v=12"></script>
  <script defer src="/static/remote-machines.js?v=6"></script>
  <script defer src="/static/ssh-floating-button.js?v=14"></script>
  <script defer src="/static/ssh-session-manager.js?v=10"></script>
  <script defer src="/static/ssh-terminal.js?v=5"></script>
  <script defer src="/static/monitor.js?v=6"></script>
  <script defer src="/static/scheduled-tasks.js?v=9"></script>
  <script defer src="/static/app.js?v=41"></script>
</body>
</html>
